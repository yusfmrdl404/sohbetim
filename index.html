<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sohbet Sitem</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f8fa;
      color: #333;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    header {
      background: #4a6fa5;
      color: white;
      padding: 20px;
      text-align: center;
    }
    .content {
      padding: 20px;
    }
    input {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-sizing: border-box;
    }
    button {
      background: #4a6fa5;
      color: white;
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background: #3a5a8c;
    }
    .btn-secondary {
      background: #6c757d;
    }
    .btn-secondary:hover {
      background: #5a6268;
    }
    #chat {
      display: none;
    }
    #messages {
      border: 1px solid #e0e0e0;
      height: 300px;
      overflow-y: auto;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
      background: #f9f9f9;
    }
    .msg {
      padding: 8px 12px;
      margin: 5px 0;
      border-radius: 12px;
      display: inline-block;
      max-width: 80%;
    }
    .msg-self {
      background: #4a6fa5;
      color: white;
      float: right;
    }
    .msg-other {
      background: #e9ecef;
      color: #333;
      float: left;
    }
    .clearfix {
      clear: both;
    }
    .alert {
      padding: 12px;
      margin: 10px 0;
      border-radius: 8px;
      font-size: 14px;
    }
    .alert-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .alert-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
  </style>
</head>
<body>

  <div class="container">
    <header>
      <h1>ðŸ’¬ Sohbet Sitem</h1>
    </header>

    <div class="content">
      <!-- UyarÄ± mesajlarÄ± -->
      <div id="alert" class="alert" style="display:none"></div>

      <!-- GiriÅŸ / KayÄ±t -->
      <div id="auth">
        <input type="email" id="email" placeholder="E-posta" />
        <input type="text" id="username" placeholder="KullanÄ±cÄ± AdÄ± (ID)" />
        <input type="password" id="password" placeholder="Åžifre" />
        <button onclick="register()">KayÄ±t Ol</button>
        <button onclick="login()">GiriÅŸ Yap</button>
        <button onclick="resetPassword()" class="btn-secondary">Åžifremi Unuttum</button>
      </div>

      <!-- Sohbet -->
      <div id="chat">
        <p><strong>HoÅŸ geldin, <span id="userLabel"></span>!</strong></p>
        <input type="text" id="searchId" placeholder="ID ile kiÅŸi ara" />
        <button onclick="startChat()">Mesaj BaÅŸlat</button>

        <div id="messages"></div>
        <div class="clearfix"></div>

        <input type="text" id="message" placeholder="Mesaj yaz..." onkeydown="if(event.key==='Enter')sendMessage()" />
        <button onclick="sendMessage()">GÃ¶nder</button>
        <button onclick="logout()" class="btn-secondary">Ã‡Ä±kÄ±ÅŸ Yap</button>
      </div>
    </div>
  </div>

  <!-- Firebase SDK (boÅŸluksuz) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    // Firebase yapÄ±landÄ±rmasÄ± (DEÄžÄ°ÅžTÄ°RME)
    const firebaseConfig = {
      apiKey: "AIzaSyCICiMDhK5MkQDq4dbV_9jkDMt4n3MUpEg",
      authDomain: "sohbetim-9a9d7.firebaseapp.com",
      databaseURL: "https://sohbetim-9a9d7-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "sohbetim-9a9d7",
      storageBucket: "sohbetim-9a9d7.firebasestorage.app",
      messagingSenderId: "277333150871",
      appId: "1:277333150871:web:d923f8cddb19ec2f672dd2",
      measurementId: "G-G5FXCJYWMC"
    };

    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.database();

    let currentUser = null;
    let chatWith = null;

    // UyarÄ± gÃ¶ster
    function showAlert(message, type) {
      const alertBox = document.getElementById("alert");
      alertBox.textContent = message;
      alertBox.className = `alert alert-${type}`;
      alertBox.style.display = "block";
      setTimeout(() => {
        alertBox.style.display = "none";
      }, 5000);
    }

    // Oturum kontrolÃ¼
    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        document.getElementById("auth").style.display = "none";
        document.getElementById("chat").style.display = "block";
        document.getElementById("userLabel").innerText = localStorage.username || "Misafir";
        loadMessages();
      } else {
        document.getElementById("chat").style.display = "none";
        document.getElementById("auth").style.display = "block";
      }
    });

    // KayÄ±t ol
    function register() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const username = document.getElementById("username").value;

      if (!username) return showAlert("LÃ¼tfen bir kullanÄ±cÄ± adÄ± (ID) girin.", "error");

      auth.createUserWithEmailAndPassword(email, password)
        .then(() => {
          localStorage.username = username;
          db.ref("users/" + auth.currentUser.uid).set({ username });
          showAlert("KayÄ±t baÅŸarÄ±lÄ±! HoÅŸ geldin.", "success");
        })
        .catch(error => {
          showAlert("Hata: " + error.message, "error");
        });
    }

    // GiriÅŸ yap
    function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      if (!email || !password) return showAlert("E-posta ve ÅŸifre girin.", "error");

      auth.signInWithEmailAndPassword(email, password)
        .then(() => {
          const username = prompt("KullanÄ±cÄ± adÄ±n (ID) nedir?");
          if (username) {
            localStorage.username = username;
          }
        })
        .catch(error => {
          showAlert("Hata: " + error.message, "error");
        });
    }

    // Åžifremi unuttum
    function resetPassword() {
      const email = document.getElementById("email").value;
      if (!email) return showAlert("Åžifre sÄ±fÄ±rlama iÃ§in e-posta adresinizi girin.", "error");

      auth.sendPasswordResetEmail(email)
        .then(() => {
          showAlert("Åžifre sÄ±fÄ±rlama baÄŸlantÄ±sÄ± e-postanÄ±za gÃ¶nderildi.", "success");
        })
        .catch(error => {
          showAlert("Hata: " + error.message, "error");
        });
    }

    // Ã‡Ä±kÄ±ÅŸ yap
    function logout() {
      auth.signOut();
      localStorage.removeItem("username");
      showAlert("BaÅŸarÄ±yla Ã§Ä±kÄ±ÅŸ yaptÄ±nÄ±z.", "success");
    }

    // Sohbet baÅŸlat
    function startChat() {
      chatWith = document.getElementById("searchId").value;
      if (!chatWith) return showAlert("LÃ¼tfen bir ID girin.", "error");
      document.getElementById("messages").innerHTML = "";
      loadMessages();
    }

    // Mesaj gÃ¶nder
    function sendMessage() {
      if (!chatWith || !currentUser) return;

      const messageInput = document.getElementById("message");
      const message = messageInput.value.trim();
      if (!message) return;

      const chatKey = [currentUser.uid, chatWith].sort().join("_");
      const chatRef = db.ref("chats/" + chatKey);

      chatRef.push({
        from: localStorage.username,
        text: message,
        time: Date.now()
      });

      messageInput.value = "";
    }

    // MesajlarÄ± yÃ¼kle
    function loadMessages() {
      if (!chatWith || !currentUser) return;

      const chatKey = [currentUser.uid, chatWith].sort().join("_");
      const chatRef = db.ref("chats/" + chatKey);

      chatRef.limitToLast(50).on("value", (snapshot) => {
        const msgDiv = document.getElementById("messages");
        msgDiv.innerHTML = "";

        snapshot.forEach((child) => {
          const data = child.val();
          const msgEl = document.createElement("div");
          msgEl.className = data.from === localStorage.username ? "msg msg-self" : "msg msg-other";
          msgEl.innerText = data.text;
          msgDiv.appendChild(msgEl);
          msgDiv.appendChild(document.createElement("div")).className = "clearfix";
        });

        msgDiv.scrollTop = msgDiv.scrollHeight;
      });
    }
  </script>
</body>
</html>
